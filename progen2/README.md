# lrc-dl
lawrencium hpc cluster for deep learning
## Run [Salesforce `ProGen2`](https://github.com/salesforce/progen/tree/main/progen2) on [Lawrencium](https://it.lbl.gov/service/scienceit/high-performance-computing/)
### Request an [Interactive Jupyter Server](https://it.lbl.gov/resource/hpc/for-users/hpc-documentation/open-ondemand/jupyter-server/) on ES1 GPU partition from [Lawrencium Open OnDemand](https://lrc-ondemand.lbl.gov)
* Connect to Jupyter and open a terminal

### Download [Salesforce `ProGen2`](https://github.com/salesforce/progen/tree/main/progen2) & Create Virtual Environment
```
# download repo
git clone https://github.com/salesforce/progen
cd progen/progen2

# create virtual env and activate it
conda create -n progen-salesforce python=3.8
conda activate progen-salesforce

# install required packages
pip3 install --upgrade pip setuptools
pip3 install -r requirements.txt
```
### Download checkpoint & run samples
```
# checkpoint
model=progen2-small
wget -P checkpoints/${model} https://storage.googleapis.com/sfr-progen-research/checkpoints/${model}.tar.gz
tar -xvf checkpoints/${model}/${model}.tar.gz -C checkpoints/${model}/
```

```
# sample
model=progen2-small
python3 sample.py --device "cuda" --model ${model} --t 0.8 --p 0.9 --max-length 1024 --num-samples 2 --context "1"      

loading parameters
loading parameters took 6.70s
loading tokenizer
loading tokenizer took 0.00s
sanity cross-entropy
2.4 2.462141275405884 0.06214127540588388
sanity cross-entropy took 0.03s
sampling
1

0
1MTEQSLLERSFRKGLALLGLCCLASALGLAQAEPAEELAPEGFTLESVSVQGRTRYLRDIAIEEETVPLGALELDQRGRLEQAIARLPGVAINRTSGAPRIVTIQGRGLQSASTLYDGAPVTNPSNNGGAAVRFDAPISDVIEGTQGVVVDAATVGVTGFVQTTVAGSATGGRQGLVDAGYGSFDAESTLAYGANGWRAGVTGGYSHRSRFEQGGLYGSVYRAGVQSELSGSAGAGAAPLGPLEPGTVTREFLPGTAGVSPGTVPGPTSYGFVDQLTLRRDDRLVQDGVSFTWSGAYFDTERPLTPAAGLDASLAAGASGLFERAGTQEATTGLGASAEGRFAERSFDLTATVRATHEDGANSASSSGFVFAPNTGGGGSRSYRETAQGFLEARADTADAWQLDAGLEGSRFRADLAPREFATATRATVGALVGVPAAEGGRDIADPTLARRASLRDRSTRLSGTLRARWDADDWRATAGLTRTRVTDSAPLDARSLTGDGYRITDLSGFGSGRPSDGLTGAVDASLGRALAAGDGGALSASLGLRHSDRRLEAADGDAGVRGTLPGGGTRDIDRTSLAGDARLGLSRRTALTGTVGLSGQDSDLRAGTSVRVRDGATVGASVGLSGGGSGGDSGSASGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSGSG

1
1MEELQNGRKQKDKTNSKQVPIRQLSAEPRDLKKLQTTLNEDSDGENQSRGKAETSPPERAEAADSASSSPKLVKEEPREETSATPQRGSEEESAPGSPGTERLPQLGDGLGLEPPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPESPEPE
sampling took 18.33s
done.
```

```
# log-likelihood (GenBank: TMF32756.1)
model=progen2-small
python3 likelihood.py --device "cuda" --model ${model} --context "1MGHGVSRPPVVTLRPAVLDDCPVLWRWRNDPETRQASVDEREIPVDTHTRWFEETLKRFDRKLFIVSADGVDAGMVRLDIQDRDAAVSVNIAPEWRGRGVGPRALGCLSREAFGPLALLRMSAVVKRENAASRIAFERAGFTVVDTGGPLLHSSKARLHVVAAIQARMGSTRLPGKVLVSIAGRPTIQRIAERLAVCQELDAVAVSTSVENRDDAIADLAAHLGLVCVRGSETDLIERLGRTAARTGADALVRITADCPLVDPALVDRVVGVWRRSAGRLEYVSNVFPPTFPDGLDVEVLSRTVLERLDREVSDPFFRESLTAYVREHPAAFEIANVEHPEDLSRLRWTMDYPEDLAFVEAVYRRLGNQGEIFGMDDLLRLLEWSPELRDLNRCREDVTVERGIRGTGYHAALRARGQAP2"

loading parameters
loading parameters took 6.65s
loading tokenizer
loading tokenizer took 0.00s
log-likelihood (left-to-right, right-to-left)
ll_sum=-1033.2456665039062
ll_mean=-2.460108757019043
log-likelihood (left-to-right, right-to-left) took 0.11s
done.
```
